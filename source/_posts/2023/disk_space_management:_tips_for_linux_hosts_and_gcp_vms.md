---
title: "[實作筆記]管理 Linux 主機與 GCP VM 的磁碟"
date: 2023/06/09 14:04:02
tags:
  - 實作筆記
---

## 前情提要

在 GCP VM 上建立的 GitLab Runner 空間不足，導致執行失敗。  
我們需要確保 GitLab Runner 有足夠的存儲空間來運行 CI 的 Jobs 。  
有兩個解決方案可供選擇：  
一、是清理磁碟空間  
透過清理磁碟空間，可以移除不需要的文件和暫存資料，釋放寶貴的儲存空間。  
二、是擴展磁碟空間  
而擴展磁碟空間則是增加磁碟的容量，讓 GitLab Runner 可以持續運行而不受空間限制。  
根據具體情況，可以選擇其中一種或兩種方案來解決空間不足的問題

## 第一部分：查詢與清理磁碟空間

要查詢 Linux 主機的磁碟空間，可以使用 df 命令。下面是使用 df 命令查詢磁碟空間的語法：

```bash
df -h
```

這將顯示磁碟空間的使用情況，包括每個檔案系統的大小、已使用的空間、可用的空間以及使用百分比。  
要查詢特定目錄或資料夾的磁碟使用情況，可以使用 du 命令。以下是使用 du 命令查詢磁碟使用情況的語法：

```bash
du -h --max-depth=1 /path/to/directory
```

這將顯示指定目錄或資料夾的磁碟使用情況，並以人類可讀的格式顯示結果。
可以查詢到一些 cache 或是 log 如果沒有必要的話，可以將之刪除。

要清除 Docker 的磁碟空間，可以使用以下語法：

```bash
docker system prune -f
```

## 第二部分：擴展 GCP VM 的磁碟空間

要在 GCP VM 上垂直擴展 boot 磁碟空間，可以按照以下步驟進行操作：

在 GCP 控制台上，找到並選擇要擴展的 VM 實例。

- 停止 VM:前往 VM instances 找到要停止的 VM，勾選後 STOP
- 調整:前往 Disks，找到要 VM instances 所用的 Disk，點擊 Edit 後增加磁碟的大小。
- 啟動 VM 實例。

## 小結

無論是清理磁碟空間還是擴展磁碟空間，都是為了讓我能確保足夠的空間供 GitLab Runner 使用，  
確保順利運行 CI Jobs！

(fin)
